DROP TABLE IF EXISTS SY_TEST_USERS;
CREATE TABLE SY_TEST_USERS AS
SELECT DISTINCT USER_ID
FROM SY_TEST_ITEMS
LEFT OUTER JOIN USER_BOUGHT_HISTORY
ON USER_BOUGHT_HISTORY.ITEM_ID = SY_TEST_ITEMS.ITEM_ID
WHERE !ISNULL (USER_ID);

DROP TABLE IF EXISTS SY_YHGM;
CREATE TABLE SY_YHGM AS
SELECT
	A.USER_ID
	WM_CONCAT(",", CONCAT(A.ITEM_ID, ":", SY_ITEMS.CAT_ID, ":", DATEDIFF(TO_DATE(CREATE_AT, "yyyymmdd"), TO_DATE("20140601", "yyyymmdd"), "DD"), ":", CASE WHEN ISNULL(SY_TEST_ITEMS.ITEM_ID) THEN 0 ELSE 1 END)) AS GMITEMS
FROM SY_TEST_USERS
LEFT OUTER JOIN USER_BOUGHT_HISTORY
ON SY_TEST_USERS.USER_ID = USER_BOUGHT_HISTORY.USER_ID
GROUP BY USER_ID;

DROP TABLE IF EXISTS SY_TEST_ITEMS_DPCATS;
CREATE TABLE SY_TEST_ITEMS_DPCATS AS
SELECT
	SY_TEST_ITEMS.ITEM_ID
	, SY_TEST_ITEMS.CAT_ID
	, CASE WHEN ISNULL(DPCATS) THEN "" ELSE DPCATS END AS DPCATS
FROM SY_TEST_ITEMS
LEFT OUTER JOIN SY_CAT_DPCATS
ON SY_TEST_ITEMS.CAT_ID = SY_CAT_DPCATS.CAT_ID;


DROP TABLE IF EXISTS SY_ITEM_YCITEM4;
CREATE TABLE SY_ITEM_YCITEM4
(
	ITEM_ID BIGINT
	, YCITEM_ID BIGINT
	, YCITEM_DPD DOUBLE
);
JAR -libjars SY_YC4.jar